<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpeedyWriter</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <header class="app-header">
        <div class="logo">
            <i class="fas fa-bolt"></i> SpeedyWriter
        </div>
        <div class="header-actions">
            <div class="theme-toggle" id="themeToggle">
                <i class="fas fa-moon theme-toggle-icon light-icon"></i>
                <i class="fas fa-sun theme-toggle-icon dark-icon"></i>
                <span class="theme-toggle-label">Dark Mode</span>
            </div>
        </div>
    </header>
    
    <!-- Landing Page - This will be shown first -->
    <div class="landing-container" id="landingContainer">
        <div class="landing-content">
            <h1 class="landing-title">Welcome to SpeedyWriter</h1>
            <p class="landing-subtitle">Your AI-powered writing assistant</p>
            
            <div class="options-container">
                <div class="option-card" id="firstDraftOption">
                    <div class="option-icon">
                        <i class="fas fa-magic"></i>
                    </div>
                    <div class="option-title">Create First Draft</div>
                    <div class="option-description">Upload a transcript and answer a few questions to get a first draft of your writing.</div>
                    <button class="option-btn">Get Started</button>
                </div>
                
                <div class="option-card" id="editorOption">
                    <div class="option-icon">
                        <i class="fas fa-edit"></i>
                    </div>
                    <div class="option-title">Start Writing</div>
                    <div class="option-description">Go directly to the editor and start writing from scratch.</div>
                    <button class="option-btn">Open Editor</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- First Draft Flow -->
    <div class="first-draft-container hidden" id="firstDraftContainer">
        <!-- Step 1: Upload or Record Transcript -->
        <div class="first-draft-step active" id="transcriptStep">
            <h2 class="step-title">Upload Your Transcript</h2>
            <p class="step-description">Upload an audio file or transcript to get started.</p>
            
            <div class="transcript-options">
                <div class="transcript-option">
                    <label for="transcriptUpload" class="upload-area">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <span>Upload Audio or Text File</span>
                        <small>Supports MP3, MP4, WAV, M4A, and TXT</small>
                        <input type="file" id="transcriptUpload" accept=".mp3,.mp4,.wav,.m4a,.txt" class="hidden">
                    </label>
                </div>
                
                <div class="transcript-divider">or</div>
                
                <div class="transcript-option">
                    <button id="recordAudioBtn" class="record-btn">
                        <i class="fas fa-microphone"></i>
                        <span>Record Audio</span>
                    </button>
                </div>
            </div>
            
            <div id="transcriptPreview" class="transcript-preview hidden">
                <div class="preview-header">
                    <h3>Transcript Preview</h3>
                    <button id="editTranscriptBtn"><i class="fas fa-edit"></i> Edit</button>
                </div>
                <div id="transcriptContent" class="preview-content" contenteditable="false"></div>
            </div>
            
            <div class="step-navigation">
                <button id="skipTranscriptBtn" class="secondary-btn">Skip</button>
                <button id="nextFromTranscriptBtn" class="primary-btn disabled">Next</button>
            </div>
        </div>
        
        <!-- Step 2: Answer Questions (Sliding Cards) -->
        <div class="first-draft-step hidden" id="questionsStep">
            <div class="questions-container">
                <div class="question-card active" data-question="1">
                    <h3 class="question-number">Question 1 of 5</h3>
                    <h2 class="question-text">What is the main topic or thesis of your writing?</h2>
                    <div class="question-input-container">
                        <textarea class="question-answer" placeholder="Enter your answer here..."></textarea>
                        <button class="question-mic-btn" title="Transcribe your answer">
                            <i class="fas fa-microphone"></i>
                        </button>
                    </div>
                    <div class="question-navigation">
                        <button class="secondary-btn back-btn" disabled>Back</button>
                        <button class="primary-btn next-btn">Next</button>
                    </div>
                </div>
                
                <div class="question-card" data-question="2">
                    <h3 class="question-number">Question 2 of 5</h3>
                    <h2 class="question-text">Who is your target audience?</h2>
                    <div class="question-input-container">
                        <textarea class="question-answer" placeholder="Enter your answer here..."></textarea>
                        <button class="question-mic-btn" title="Transcribe your answer">
                            <i class="fas fa-microphone"></i>
                        </button>
                    </div>
                    <div class="question-navigation">
                        <button class="secondary-btn back-btn">Back</button>
                        <button class="primary-btn next-btn">Next</button>
                    </div>
                </div>
                
                <div class="question-card" data-question="3">
                    <h3 class="question-number">Question 3 of 5</h3>
                    <h2 class="question-text">What are the key points you want to address?</h2>
                    <div class="question-input-container">
                        <textarea class="question-answer" placeholder="Enter your answer here..."></textarea>
                        <button class="question-mic-btn" title="Transcribe your answer">
                            <i class="fas fa-microphone"></i>
                        </button>
                    </div>
                    <div class="question-navigation">
                        <button class="secondary-btn back-btn">Back</button>
                        <button class="primary-btn next-btn">Next</button>
                    </div>
                </div>
                
                <div class="question-card" data-question="4">
                    <h3 class="question-number">Question 4 of 5</h3>
                    <h2 class="question-text">What tone or style would you like for this piece?</h2>
                    <div class="question-input-container">
                        <textarea class="question-answer" placeholder="Enter your answer here..."></textarea>
                        <button class="question-mic-btn" title="Transcribe your answer">
                            <i class="fas fa-microphone"></i>
                        </button>
                    </div>
                    <div class="question-navigation">
                        <button class="secondary-btn back-btn">Back</button>
                        <button class="primary-btn next-btn">Next</button>
                    </div>
                </div>
                
                <div class="question-card" data-question="5">
                    <h3 class="question-number">Question 5 of 5</h3>
                    <h2 class="question-text">What's the desired length and format (essay, report, article, etc.)?</h2>
                    <div class="question-input-container">
                        <textarea class="question-answer" placeholder="Enter your answer here..."></textarea>
                        <button class="question-mic-btn" title="Transcribe your answer">
                            <i class="fas fa-microphone"></i>
                        </button>
                    </div>
                    <div class="question-navigation">
                        <button class="secondary-btn back-btn">Back</button>
                        <button class="primary-btn generate-btn">Generate Draft</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Step 3: Generating Draft (Loading Screen) -->
        <div class="first-draft-step hidden" id="generatingStep">
            <div class="generating-container">
                <div class="generating-spinner">
                    <i class="fas fa-spinner fa-spin"></i>
                </div>
                <h2 class="generating-title">Creating Your First Draft</h2>
                <p class="generating-description">Please wait while we generate your custom draft based on your transcript and answers.</p>
            </div>
        </div>
    </div>
    
    <!-- Main Editor (existing functionality) -->
    <div class="main-container hidden" id="editorContainer">
        <div class="toolbar" id="toolbar">
            <div class="toolbar-group">
                <button class="tool-btn" data-command="formatBlock" data-value="h1" title="Heading 1">
                    <i class="fas fa-heading"></i>
                    <span class="shortcut-tooltip"><span class="kbd">Ctrl</span> + <span class="kbd">Alt</span> + <span class="kbd">1</span></span>
                </button>
                <button class="tool-btn" data-command="formatBlock" data-value="h2" title="Heading 2">
                    <i class="fas fa-heading" style="font-size: 0.9em;"></i>
                    <span class="shortcut-tooltip"><span class="kbd">Ctrl</span> + <span class="kbd">Alt</span> + <span class="kbd">2</span></span>
                </button>
                <button class="tool-btn" data-command="formatBlock" data-value="h3" title="Heading 3">
                    <i class="fas fa-heading" style="font-size: 0.8em;"></i>
                    <span class="shortcut-tooltip"><span class="kbd">Ctrl</span> + <span class="kbd">Alt</span> + <span class="kbd">3</span></span>
                </button>
            </div>
            
            <div class="toolbar-group">
                <button class="tool-btn" data-command="bold" title="Bold">
                    <i class="fas fa-bold"></i>
                    <span class="shortcut-tooltip"><span class="kbd">Ctrl</span> + <span class="kbd">B</span></span>
                </button>
                <button class="tool-btn" data-command="italic" title="Italic">
                    <i class="fas fa-italic"></i>
                    <span class="shortcut-tooltip"><span class="kbd">Ctrl</span> + <span class="kbd">I</span></span>
                </button>
                <button class="tool-btn" data-command="underline" title="Underline">
                    <i class="fas fa-underline"></i>
                    <span class="shortcut-tooltip"><span class="kbd">Ctrl</span> + <span class="kbd">U</span></span>
                </button>
                <button class="tool-btn" data-command="strikeThrough" title="Strikethrough">
                    <i class="fas fa-strikethrough"></i>
                    <span class="shortcut-tooltip"><span class="kbd">Ctrl</span> + <span class="kbd">Shift</span> + <span class="kbd">X</span></span>
                </button>
            </div>
            
            <div class="toolbar-group">
                <button class="tool-btn" data-command="justifyLeft" title="Align Left">
                    <i class="fas fa-align-left"></i>
                    <span class="shortcut-tooltip"><span class="kbd">Ctrl</span> + <span class="kbd">Shift</span> + <span class="kbd">L</span></span>
                </button>
                <button class="tool-btn" data-command="justifyCenter" title="Align Center">
                    <i class="fas fa-align-center"></i>
                    <span class="shortcut-tooltip"><span class="kbd">Ctrl</span> + <span class="kbd">Shift</span> + <span class="kbd">E</span></span>
                </button>
                <button class="tool-btn" data-command="justifyRight" title="Align Right">
                    <i class="fas fa-align-right"></i>
                    <span class="shortcut-tooltip"><span class="kbd">Ctrl</span> + <span class="kbd">Shift</span> + <span class="kbd">R</span></span>
                </button>
            </div>
            
            <div class="toolbar-group">
                <button class="tool-btn" data-command="insertUnorderedList" title="Bullet List">
                    <i class="fas fa-list-ul"></i>
                    <span class="shortcut-tooltip"><span class="kbd">Ctrl</span> + <span class="kbd">Shift</span> + <span class="kbd">8</span></span>
                </button>
                <button class="tool-btn" data-command="insertOrderedList" title="Numbered List">
                    <i class="fas fa-list-ol"></i>
                    <span class="shortcut-tooltip"><span class="kbd">Ctrl</span> + <span class="kbd">Shift</span> + <span class="kbd">7</span></span>
                </button>
                <button class="tool-btn" data-command="formatBlock" data-value="blockquote" title="Quote">
                    <i class="fas fa-quote-right"></i>
                    <span class="shortcut-tooltip"><span class="kbd">Ctrl</span> + <span class="kbd">Shift</span> + <span class="kbd">.</span></span>
                </button>
            </div>
            
            <div class="toolbar-group">
                <button class="tool-btn" data-command="createLink" title="Insert Link">
                    <i class="fas fa-link"></i>
                    <span class="shortcut-tooltip"><span class="kbd">Ctrl</span> + <span class="kbd">K</span></span>
                </button>
                <button class="tool-btn" data-command="insertHorizontalRule" title="Horizontal Line">
                    <i class="fas fa-minus"></i>
                    <span class="shortcut-tooltip"><span class="kbd">Ctrl</span> + <span class="kbd">Alt</span> + <span class="kbd">-</span></span>
                </button>
                <button class="tool-btn" data-command="removeFormat" title="Clear Formatting">
                    <i class="fas fa-eraser"></i>
                    <span class="shortcut-tooltip"><span class="kbd">Ctrl</span> + <span class="kbd">\</span></span>
                </button>
            </div>
        </div>
        
        <div class="editor-wrapper" id="editorWrapper">
            <div class="paper" id="editor" contenteditable="true" spellcheck="true">
                <p>Start writing your essay here or use the features in the floating menu to the right.</p>
                <p>You can format your text with the toolbar at the top. Try selecting some text and formatting it!</p>
                <p>Hover over any button to see the keyboard shortcut.</p>
            </div>
        </div>
        
        <div class="floating-tools" id="floatingTools">
            <div class="floating-tools-toggle" id="floatingToolsToggle">
                <i class="fas fa-plus"></i>
            </div>
            <div class="floating-tools-inner">
                <div class="floating-tools-handle" id="floatingToolsHandle">
                    <i class="fas fa-grip-lines"></i>
                </div>
                <div class="floating-tool" id="aiRewriteBtn" title="AI Rewrite">
                    <i class="fas fa-robot"></i>
                    <span class="shortcut-tooltip">AI Rewrite <span class="kbd">Ctrl</span>+<span class="kbd">R</span></span>
                </div>
                <div class="floating-tool" id="speakBtn" title="Speech to Text">
                    <i class="fas fa-microphone"></i>
                    <span class="shortcut-tooltip">Speech to Text <span class="kbd">Ctrl</span>+<span class="kbd">D</span></span>
                </div>
                <div class="floating-tool" id="commentsBtn" title="Add Comment">
                    <i class="fas fa-comment-alt"></i>
                    <span class="shortcut-tooltip">Add Comment <span class="kbd">Ctrl</span>+<span class="kbd">/</span></span>
                </div>
            </div>
        </div>
    </div>
    
    <div class="status-bar" id="statusBar">
        <div class="word-count">
            <span id="wordCount">0 words</span>
            <span id="charCount">0 characters</span>
        </div>
        <div id="saveStatus">All changes saved</div>
    </div>
    
    <!-- Recording Indicator -->
    <div class="recording-indicator" id="recordingIndicator">
        <div class="pulse"></div>
        <span>Recording... Click to stop</span>
    </div>
    
    <!-- API Key Modal for Anthropic -->
    <div class="modal" id="anthropicKeyModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Anthropic API Key Required</h3>
                <button class="close-modal" id="closeAnthropicModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p>To use AI features, please enter your Anthropic API key. This key will be saved in your browser's local storage.</p>
                <label for="anthropicApiKey">Anthropic API Key:</label>
                <input type="password" id="anthropicApiKey" placeholder="sk-ant-...">
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelAnthropicKey">Cancel</button>
                <button class="btn btn-primary" id="saveAnthropicKey">
                    <i class="fas fa-save"></i> Save Key
                </button>
            </div>
        </div>
    </div>
    
    <!-- API Key Modal for AssemblyAI -->
    <div class="modal" id="assemblyAIKeyModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">AssemblyAI API Key Required</h3>
                <button class="close-modal" id="closeAssemblyAIModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p>To use speech-to-text features, please enter your AssemblyAI API key. This key will be saved in your browser's local storage.</p>
                <label for="assemblyAIApiKey">AssemblyAI API Key:</label>
                <input type="password" id="assemblyAIApiKey" placeholder="Your AssemblyAI API key">
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelAssemblyAIKey">Cancel</button>
                <button class="btn btn-primary" id="saveAssemblyAIKey">
                    <i class="fas fa-save"></i> Save Key
                </button>
            </div>
        </div>
    </div>
    
    <!-- AI Rewrite Modal -->
    <div class="modal" id="aiRewriteModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">AI Rewrite with Claude</h3>
                <button class="close-modal" id="closeAiModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <label>Selected text:</label>
                <div class="selected-text-preview" id="selectedText"></div>
                <label for="aiPrompt">How would you like to improve this text?</label>
                <textarea id="aiPrompt" placeholder="E.g., Make it more formal, simplify it, make it more persuasive..."></textarea>
                
                <div id="diffContainer" class="diff-container" style="display: none;">
                    <div class="diff-title">Suggestion:</div>
                    <div id="diffOriginal" class="diff-original">
                        <span class="diff-label">Original</span>
                        <div id="diffOriginalText"></div>
                    </div>
                    <div id="diffSuggested" class="diff-suggested">
                        <span class="diff-label">Suggested</span>
                        <div id="diffSuggestedText"></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelAiRewrite">Cancel</button>
                <button class="btn btn-primary" id="submitAiRewrite">
                    <i class="fas fa-magic"></i> Generate
                </button>
                <button class="btn btn-primary" id="applyAiSuggestion" style="display: none;">
                    <i class="fas fa-check"></i> Apply
                </button>
                <button class="btn btn-secondary" id="regenerateAiSuggestion" style="display: none;">
                    <i class="fas fa-sync-alt"></i> Regenerate
                </button>
            </div>
        </div>
    </div>
    
    <!-- Transcript Recording Modal -->
    <div class="modal" id="recordingModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Record Audio</h3>
                <button class="close-modal" id="closeRecordingModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="recording-status" id="recordingStatus">
                    <div class="recording-waveform" id="recordingWaveform">
                        <div class="waveform-bar"></div>
                        <div class="waveform-bar"></div>
                        <div class="waveform-bar"></div>
                        <div class="waveform-bar"></div>
                        <div class="waveform-bar"></div>
                    </div>
                    <div class="recording-time" id="recordingTime">00:00</div>
                </div>
                <div class="recording-instructions">
                    <p>Click 'Start Recording' to begin. Speak clearly into your microphone.</p>
                    <p>Click 'Stop' when you're finished to process your recording.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelRecording">Cancel</button>
                <button class="btn btn-primary" id="startRecordingBtn">
                    <i class="fas fa-microphone"></i> Start Recording
                </button>
                <button class="btn btn-danger" id="stopRecordingBtn" style="display: none;">
                    <i class="fas fa-stop"></i> Stop
                </button>
            </div>
        </div>
    </div>
    
    <!-- Transcript Edit Modal -->
    <div class="modal" id="editTranscriptModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Edit Transcript</h3>
                <button class="close-modal" id="closeEditTranscriptModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p>Make any necessary edits to your transcript:</p>
                <textarea id="editTranscriptText" class="edit-transcript-textarea"></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelEditTranscript">Cancel</button>
                <button class="btn btn-primary" id="saveEditTranscript">
                    <i class="fas fa-save"></i> Save Changes
                </button>
            </div>
        </div>
    </div>
    
    <!-- Inline Comment Template (will be cloned and used) -->
    <div id="inlineCommentTemplate" style="display: none;">
        <div class="inline-comment">
            <div class="inline-comment-header">
                <div class="inline-comment-title">Add Comment</div>
                <button class="inline-comment-close"><i class="fas fa-times"></i></button>
            </div>
            <div class="inline-comment-body">
                <textarea placeholder="Type your comment here..."></textarea>
            </div>
            <div class="inline-comment-footer">
                <button class="btn btn-primary btn-sm save-comment">
                    <i class="fas fa-save"></i> Save
                </button>
            </div>
        </div>
    </div>
    
    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <div class="toast-icon success" id="toastIcon">
            <i class="fas fa-check-circle"></i>
        </div>
        <div id="toastMessage">Operation successful</div>
    </div>
    
    <script src="/static/script.js"></script>
</body>
</html>